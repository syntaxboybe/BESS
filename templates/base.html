{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="{% static 'img/favicon-48x48.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/font.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'nav-tab.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'line-awesome/css/line-awesome.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap-datepicker.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/dataTables.bootstrap5.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/jquery.dataTables.yadcf.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/dataTables.dateTime.min.css' %}">
    <!-- Dark Mode CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/dark-mode.css' %}">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">


    <script src="{% static 'bootstrap/js/jquery.min.js' %}" ></script>
    <script src="{% static 'bootstrap/js/jquery.dataTables.js' %}" ></script>
    <script src="{% static 'bootstrap/js/dataTables.bootstrap5.min.js' %}" ></script>
    <script src="{% static 'bootstrap/js/bootstrap.min.js' %}" ></script>
    <script src="{% static 'bootstrap/js/filterDropDown.min.js' %}" ></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="{% static 'bootstrap/js/pdfmake.min.js' %}" ></script>
    <script src="{% static 'bootstrap/js/vfs_fonts.js' %}" ></script>
    <script src="{% static 'bootstrap/js/datatables.min.js' %}" ></script>
    <script src="{% static 'bootstrap/js/jquery.dataTables.yadcf.js' %}" ></script>
    <script src="{% static 'bootstrap/js/moment.min.js' %}" ></script>
    <script src="{% static 'bootstrap/js/dataTables.dateTime.min.js' %}" ></script>
    <!-- Dark Mode JS -->
    <script src="{% static 'bootstrap/js/dark-mode.js' %}" ></script>

    <!-- SweetAlert2 Global Configuration -->
    <script>
    // Configure SweetAlert2 with dark mode support
    document.addEventListener('DOMContentLoaded', function() {
      // Create global SweetAlert2 dark mode styles
      const sweetAlertDarkModeStyles = document.createElement('style');
      sweetAlertDarkModeStyles.textContent = `
        /* Dark mode styles for all SweetAlert2 popups */
        body.dark-mode .swal2-popup {
          background-color: #333 !important;
          color: #fff !important;
        }
        body.dark-mode .swal2-title {
          color: #4CAF50 !important;
          border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .swal2-html-container,
        body.dark-mode .swal2-content {
          color: #ddd !important;
        }
        body.dark-mode .swal2-input,
        body.dark-mode .swal2-textarea {
          background-color: #444 !important;
          color: #fff !important;
          border-color: #555 !important;
        }
        body.dark-mode .swal2-validation-message {
          background-color: #3a3a3a !important;
          color: #f27474 !important;
        }
        body.dark-mode .swal2-confirm,
        body.dark-mode .swal2-deny,
        body.dark-mode .swal2-cancel {
          filter: brightness(0.85);
        }
        body.dark-mode .swal2-confirm:focus,
        body.dark-mode .swal2-deny:focus,
        body.dark-mode .swal2-cancel:focus {
          box-shadow: 0 0 0 3px rgba(50, 200, 50, 0.4) !important;
        }
        body.dark-mode .text-muted {
          color: #bbb !important;
        }
        /* Improve timer progress bar visibility in dark mode */
        body.dark-mode .swal2-timer-progress-bar {
          background: rgba(76, 175, 80, 0.6) !important;
        }
      `;
      document.head.appendChild(sweetAlertDarkModeStyles);

      // Create a SweetAlert2 hook to apply dark mode to all alerts
      const originalSwalFire = Swal.fire;
      Swal.fire = function() {
        // Get the arguments passed to Swal.fire
        const args = Array.from(arguments);

        // Check if args is an object (most common usage)
        if (args.length === 1 && typeof args[0] === 'object') {
          const isDarkMode = document.body.classList.contains('dark-mode');

          // Merge with dark mode settings if needed
          if (isDarkMode) {
            args[0] = Object.assign({}, args[0], {
              background: args[0].background || '#333',
              color: args[0].color || '#fff'
            });
          }
        }

        // Call the original Swal.fire with potentially modified arguments
        return originalSwalFire.apply(this, args);
      };

      // Update SweetAlert style when dark mode changes
      const darkModeToggle = document.getElementById('darkModeToggle');
      if (darkModeToggle) {
        darkModeToggle.addEventListener('click', function() {
          // Any open SweetAlert will be properly styled via CSS
        });
      }
    });
    </script>

<style>
    .dropdown-menu .dropdown-item {
        color: white; /* Default text color */
    }

    .dropdown-menu .dropdown-item:hover,
    .dropdown-menu .dropdown-item:focus {
        color: black; /* Text color when highlighted */
    }

    .dropdown-menu {
        background-color: #008000; /* Keep the green background */
    }

    /* Make the pending status badge visible in both light and dark modes */
    .badge-pending,
    .badge-warning,
    .badge-yellow {
        background-color: #ffff00 !important;
        color: #000000 !important;
        font-weight: bold !important;
        border: 1px solid rgba(0, 0, 0, 0.2);
    }

    /* Ensure all status badges are visible in dark mode */
    body.dark-mode .badge {
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Specific fixes for yellow/pending badges in dark mode */
    body.dark-mode .badge-pending,
    body.dark-mode .badge-warning,
    body.dark-mode .badge-yellow,
    body.dark-mode .bg-warning,
    body.dark-mode .bg-yellow,
    body.dark-mode [class*="bg-yellow-"] {
        color: #000 !important;
        font-weight: bold !important;
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
    }

    /* For text that says "Pending" without a badge class */
    body.dark-mode .text-warning,
    body.dark-mode .text-yellow,
    body.dark-mode .pending-status {
        color: #ffff00 !important;
        font-weight: bold !important;
        text-shadow: 0px 0px 2px rgba(0, 0, 0, 0.8);
    }
</style>

  <title>Barangay E-Service System</title>
</head>

<body class="fixed-navbar-layout">

    <div id="loading">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="main-container d-flex">
        <div class="sidebar" id="side_nav" style="background-color: #355389;">
            <div class="header-box px-2 pt-3 pb-4 d-flex justify-content-between">

                <div class="row">
                    <div class="col-2">
                        <div><img src="{%static 'img/poblacionlogo.png' %}" height="60"></div>
                    </div>
                    <div class="col-10 px-4 pt-2">
                        <div class=""><h6 class="" style="color: #FFFFFF;"><b>BARANGAY POBLACION</b></h6></div>
                    <div class="" style="margin-top: -2px;">
                        <h6 class="" style="color: #50C878;"><b>Barangay E-Service System</b></h6>
                      </div>
                  </div>
                </div>

                <button class="btn d-md-none d-block close-btn px-1 py-0 text-white"><i class="las la-bars fs-5"></i></button>

            </div>
            <ul class="list-unstyled px-2">
                <li class=""><a href="{% url 'dashboard' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fa fa-line-chart"></i><b> Dashboard</b></a></li>

 {% if request.user.groups.all.0.name == 'superadmin' %}
            <li class=""><a href="{% url 'announcementPage' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-bullhorn"></i><b> Announcements</b></a></li>
                {% endif %}

                {% if request.user.groups.all.0.name == 'superadmin' %}
<div class="side-sub-menu py-2">
                    <div class="accordion-button px-3 py-2" data-bs-toggle="collapse" href="#collapseAccounts" aria-expanded="false" aria-controls="collapseAccounts" style="background-color: #008000;">
                        <a class="text-decoration-none d-block">
                            <i class="fas fa-address-card"></i><b> Accounts</b>
                        </a>
                    </div>

                    <div class="ps-3 sub-content" style="background-color: #008000;">
                        <ul class="list-unstyled px-2 py-2 collapse" id="collapseAccounts">

                <li class=""><a href="{% url 'add_official_account' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-user-plus"></i> Add Account</a></li>
                <li class=""><a href="{% url 'officialList' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-user-circle"></i> Account Record</a></li>
                </ul>
                    </div>
                    {% endif %}

              {% if request.user.id != 30 %}
              {% if request.user.groups.all.0.name != 'superadmin' %}
                <div class="side-sub-menu py-2">
                    <div class="accordion-button px-3 py-2" data-bs-toggle="collapse" href="#collapseResident" aria-expanded="false" aria-controls="collapseResident" style="background-color: #008000;">
                        <a class="text-decoration-none d-block">
                            <i class="fas fa-address-card"></i><b> Profiling</b>
                        </a>
                    </div>


<div class="ps-3 sub-content" style="background-color: #008000;">
    <ul class="list-unstyled px-2 py-2 collapse" id="collapseResident">
        <li>
            <a href="{% url 'resident_list' %}" class="text-decoration-none px-3 py-2 d-block">
                <i class="fas fa-users"></i> Residents
            </a>
        </li>

        <li>
            <a href="{% url 'pwd' %}" class="text-decoration-none px-3 py-2 d-block">
                <i class="fas fa-wheelchair"></i> PWD
            </a>
        </li>

        <li>
            <a href="{% url 'senior' %}" class="text-decoration-none px-3 py-2 d-block">
                <i class="fas fa-user-clock"></i> Senior Citizen
            </a>
        </li>

        <li>
            <a href="{% url 'single' %}" class="text-decoration-none px-3 py-2 d-block">
                <i class="fas fa-user"></i> Single Parent
            </a>
        </li>
    </ul>
</div>

              {% endif %}
              {% endif %}

        {% if not request.user.groups.all.0.name == 'superadmin' %}
<div class="side-sub-menu py-2">
                    <div class="accordion-button px-3 py-2" data-bs-toggle="collapse" href="#collapseIssuances" aria-expanded="false" aria-controls="collapseIssuances" style="background-color: #008000;">
                        <a class="text-decoration-none d-block">
                            <i class="fas fa-file-alt"></i><b> Issuances</b>
                        </a>
                    </div>

                    <div class="ps-3 sub-content" style="background-color: #008000;">
                        <ul class="list-unstyled px-2 py-2 collapse" id="collapseIssuances">

                <li class=""><a href="{% url 'clearance'%}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-file-alt "></i> Barangay Clearance</a></li>
                <li class=""><a href="{% url 'indigency_request' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-feather-alt "></i> Certificate of Indigency</a></li>
                <li class=""><a href="{% url 'business_permit_module' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-file-contract "></i> Barangay Business Permit</a></li>
                <li class=""><a href="{% url 'building_permit_module' %}" class="text-decoration-none px-3 py-2 d-block"><i class="far fa-building "></i> Barangay Building Permit</a></li>
                <li class=""><a href="{% url 'residency_certificate_module' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-certificate "></i> Certificate of Residency</a></li>
                </ul>
          {% endif %}

          {% if not request.user.groups.all.0.name != 'superadmin' %}
          <div class="side-sub-menu py-2">
                <!--<hr class="h-color mx-3">-->
                <li class=""><a href="{% url 'adminProfile' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-user"></i><b> Profile </b></a></li>
                <!--<hr class="h-color mx-3">-->
                {% endif %}
               </div>

                {% if request.user.id != 30 %}
                {% if not request.user.groups.all.0.name == 'superadmin' %}
          <div class="side-sub-menu py-2">
                    <div class="accordion-button px-3 py-2" data-bs-toggle="collapse" href="#collapseReports" aria-expanded="false" aria-controls="collapseReports" style="background-color: #008000;">
                        <a class="text-decoration-none d-block">
                            <i class="fas fa-calendar-week"></i><b> Reports</b>
                        </a>
                    </div>

                    <div class="ps-3 sub-content" style="background-color: #008000;">
                        <ul class="list-unstyled px-2 py-2 collapse" id="collapseReports">
                            <li class="">
                                <li class=""><a href="{% url 'reports' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-file-archive"></i> Issued Documents </a></li>
                            </li>

                            <li class="">
                                <li class=""><a href="{% url 'clearance_reports' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-file-signature"></i>Issued Clearance </a></li>
                            </l>

                            <li class="">
                                <li class=""><a href="{% url 'indigency_reports' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-file-invoice"></i> Issued Indigency </a></li>
                            </li>

                            <li class="">
                                <li class=""><a href="{% url 'business_reports' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-file-invoice-dollar"></i> Issued Business Permit </a></li>
                            </li>

                            <li class="">
                                <li class=""><a href="{% url 'building_reports' %}" class="text-decoration-none px-3 py-2 d-block"><i class="far fa-building"></i> Issued Building Permit </a></li>
                            </li>

                            <li class="">
                                <li class=""><a href="{% url 'residency_reports' %}" class="text-decoration-none px-3 py-2 d-block"><i class="far fa-id-badge"></i> Issued Residency </a></li>
                            </li>

                        </ul>
                    </div>
                </div>
                {% endif %}
                {% endif %}

                {% if request.user.id != 30 %}
                {% if not request.user.groups.all.0.name == 'superadmin' %}
                <li class=""><a href="{% url 'requestLogs' %}" class="text-decoration-none px-3 py-2 d-block"><i class="fas fa-history fs-5"></i><b> Request Logs</b></a></li>
                <div class="side-sub-menu">

                {% endif %}
                {% endif %}

            </ul>

        </div>

        <div class="content">
            <nav class="navbar navbar-expand-md navbar-light bg-light nav-bottom">
              <div class="container-fluid">
                    <div class="d-flex justify-content-between d-md-none d-block">
                        <button class="btn px-1 py-0 open-btn me-2"><i class="las la-bars fs-5"></i></button>
                        <a class="navbar-brand fd-4" href="#"><img src="{%static 'img/poblacionlogo.png' %}" height="40"><span class="px-2 py-0 h4">Barangay Poblacion</span></a>
                    </div>
                    <div class="d-none d-md-block">
                        <!-- Empty div to balance the navbar on desktop -->
                    </div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                    <ul class="navbar-nav mb-2 mb-lg-0">

{% if user.id != 1 %}
<li class="nav-item dropdown">
  <a class="nav-link" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="fa-solid fa-bell fs-5"></i>
    {% if notifications.pending_counts.total > 0 %}
    <span class="badge" style="background-color: #008000; color: white;">{{ notifications.pending_counts.total }}</span>
    {% endif %}
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown" style="background-color: #008000; color: white; max-height: 500px; overflow-y: auto;">
    <!-- Notification Title -->
    <li>
      <h6 class="dropdown-header text-white" style="background-color: #355389; position: sticky; top: 0; z-index: 1000;">
        <center><b>NOTIFICATIONS</b></center>
      </h6>
    </li>

    {% if notifications.pending_counts.total > 0 %}
      <!-- New Requests Section -->
      <li>
        <h6 class="dropdown-header text-white" style="background-color: #006400;">New Requests</h6>
      </li>

      {% if notifications.latest_requests.clearance %}
        {% for request in notifications.latest_requests.clearance %}
        <li>
          <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'clearance' %}">
            <div>
              <i class="fas fa-file-alt me-2"></i> Barangay Clearance
              <small class="d-block text-white-50">{{ request.res_id.firstname }} {{ request.res_id.lastname }}</small>
              <small class="d-block text-white-50">{{ request.date_requested|date:"M d, Y h:i A" }}</small>
            </div>
            <span class="badge rounded-pill bg-danger">New</span>
          </a>
        </li>
        {% endfor %}
      {% endif %}

      {% if notifications.latest_requests.indigency %}
        {% for request in notifications.latest_requests.indigency %}
        <li>
          <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'indigency_request' %}">
            <div>
              <i class="fas fa-feather-alt me-2"></i> Certificate of Indigency
              <small class="d-block text-white-50">{{ request.res_id.firstname }} {{ request.res_id.lastname }}</small>
              <small class="d-block text-white-50">{{ request.date_requested|date:"M d, Y h:i A" }}</small>
            </div>
            <span class="badge rounded-pill bg-danger">New</span>
          </a>
        </li>
        {% endfor %}
      {% endif %}

      {% if notifications.latest_requests.business %}
        {% for request in notifications.latest_requests.business %}
        <li>
          <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'business_permit_module' %}">
            <div>
              <i class="fas fa-file-contract me-2"></i> Business Permit
              <small class="d-block text-white-50">{{ request.res_id.firstname }} {{ request.res_id.lastname }}</small>
              <small class="d-block text-white-50">{{ request.date_requested|date:"M d, Y h:i A" }}</small>
            </div>
            <span class="badge rounded-pill bg-danger">New</span>
          </a>
        </li>
        {% endfor %}
      {% endif %}

      {% if notifications.latest_requests.building %}
        {% for request in notifications.latest_requests.building %}
        <li>
          <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'building_permit_module' %}">
            <div>
              <i class="far fa-building me-2"></i> Building Permit
              <small class="d-block text-white-50">{{ request.res_id.firstname }} {{ request.res_id.lastname }}</small>
              <small class="d-block text-white-50">{{ request.date_requested|date:"M d, Y h:i A" }}</small>
            </div>
            <span class="badge rounded-pill bg-danger">New</span>
          </a>
        </li>
        {% endfor %}
      {% endif %}

      {% if notifications.latest_requests.residency %}
        {% for request in notifications.latest_requests.residency %}
        <li>
          <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'residency_certificate_module' %}">
            <div>
              <i class="fas fa-certificate me-2"></i> Certificate of Residency
              <small class="d-block text-white-50">{{ request.res_id.firstname }} {{ request.res_id.lastname }}</small>
              <small class="d-block text-white-50">{{ request.date_requested|date:"M d, Y h:i A" }}</small>
            </div>
            <span class="badge rounded-pill bg-danger">New</span>
          </a>
        </li>
        {% endfor %}
      {% endif %}

      <!-- View All Requests -->
      <li><hr class="dropdown-divider bg-white opacity-25"></li>
      <li>
        <div class="dropdown-header text-center">
          <a href="#" class="text-white" style="text-decoration: none;" onclick="markAllAsRead(); return false;">
            <i class="fas fa-check-double me-1"></i> Mark all as read
          </a>
        </div>
      </li>
    {% else %}
      <li>
        <div class="dropdown-item text-center text-white-50">
          No new notifications
        </div>
      </li>
    {% endif %}
  </ul>
</li>
{% endif %}

<!-- Fullscreen Toggle Button -->
<li class="nav-item">
  <a class="nav-link" href="#" id="fullscreenToggle" title="Toggle fullscreen">
    <i class="fas fa-expand fs-5" id="expandIcon"></i>
    <i class="fas fa-compress fs-5 d-none" id="compressIcon"></i>
  </a>
</li>

<!-- Dark Mode Toggle Button -->
<li class="nav-item">
  <a class="nav-link" href="#" id="darkModeToggle" title="Toggle dark/light mode">
    <i class="fas fa-moon fs-5" id="lightModeIcon"></i>
    <i class="fas fa-sun fs-5 d-none" id="darkModeIcon"></i>
  </a>
</li>

                      <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#"><i class="fas fa-user fs-5 me-2"></i> {{ user.username }}</a>
                        </li>

                        <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'adminLogout' %}"><i class="fas fa-sign-out-alt fs-5"></i> Logout</a>
                        </li>
                    </ul>
                    </div>
                </div>
            </nav>

            <div class="dashboard-content px-3 pt-4">
                {% block content %}
                {% endblock content %}
            </div>
        </div>
    </div>



<script src="{% static 'bootstrap/js/bootstrap-datepicker.min.js' %}" ></script>
<script src="{% static 'bootstrap/js/datepicker.js' %}" ></script>
<script src="{% static 'bootstrap/js/img-preview.js' %}" ></script>

<script src="{% static 'bootstrap/js/htmx.min.js' %}" ></script>
<script src="{% static 'bootstrap/js/dialog.js' %}" ></script>

<script src="{% static 'bootstrap/js/function.js' %}" ></script>
<script src="{% static 'bootstrap/js/issued_document_datatable.js' %}" ></script>
<script src="{% static 'bootstrap/js/requested_documents_logs.js' %}" ></script>
{% if user.id != 1 and not user.groups.all.0.name == 'superadmin' %}
<script src="{% static 'js/notifications.js' %}" ></script>

<script>
// New notification alert functionality
document.addEventListener('DOMContentLoaded', function() {
  // Check if we're on the dashboard page
  const isDashboardPage = window.location.pathname.includes('/Dashboard') || window.location.pathname === '/' || window.location.pathname === '';

  // Only show notification on dashboard page
  if (!isDashboardPage) return;

  // Check if there are new notifications
  const notificationBadge = document.querySelector('.fa-bell + .badge');

  if (notificationBadge) {
    const notificationCount = parseInt(notificationBadge.innerText);

    if (notificationCount > 0) {
      // Get notification details for the alert
      const latestNotifications = [];

      // Get all notification items
      const notificationItems = document.querySelectorAll('.dropdown-item .badge');
      let maxNotificationsToShow = Math.min(notificationItems.length, 3); // Limit to 3 max

      for (let i = 0; i < maxNotificationsToShow; i++) {
        const item = notificationItems[i].closest('.dropdown-item');
        if (item) {
          const icon = item.querySelector('div i').cloneNode(true);
          const title = item.querySelector('div i').nextSibling.textContent.trim();
          const name = item.querySelector('small:nth-of-type(1)').textContent.trim();
          const date = item.querySelector('small:nth-of-type(2)').textContent.trim();

          // Create HTML structure for each notification entry
          const entryHtml = `
            <div class="notification-item">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="fw-bold">${title}</span>
                <span class="badge rounded-pill bg-danger">New</span>
              </div>
              <div class="text-muted small">${name}</div>
              <div class="text-muted small">${date}</div>
            </div>
          `;
          latestNotifications.push(entryHtml);
        }
      }

      // Create notification message
      let notificationHtml = '';
      if (latestNotifications.length > 0) {
        notificationHtml = latestNotifications.join('<hr class="my-2">');
        if (notificationCount > latestNotifications.length) {
          notificationHtml += `<hr class="my-2"><div class="text-center">...and ${notificationCount - latestNotifications.length} more</div>`;
        }
      } else {
        notificationHtml = '<div class="text-center">You have new document requests.</div>';
      }

      // Add mark all as read button
      notificationHtml += `
        <div class="text-center mt-3">
          <button class="btn btn-sm btn-outline-success" onclick="markAllAsRead(); Swal.close();">
            <i class="fas fa-check-double me-1"></i> Mark all as read
          </button>
        </div>
      `;

      // Show SweetAlert notification - dark mode is automatically applied by global config
      Swal.fire({
        title: 'New Requests',
        icon: null,
        html: notificationHtml,
        showConfirmButton: false,
        showCloseButton: true,
        width: '350px',
        padding: '1rem',
        customClass: {
          container: 'notification-container',
          popup: 'notification-popup',
          title: 'text-success fw-bold',
          closeButton: 'notification-close-btn'
        }
      });

      // Add CSS for notification styling (non-dark-mode specific)
      const style = document.createElement('style');
      style.textContent = `
        .notification-container {
          z-index: 9999;
        }
        .notification-popup {
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          overflow: hidden;
        }
        .notification-item {
          padding: 8px 0;
        }
        .swal2-title {
          font-size: 1.25rem;
          color: #008000 !important;
          font-weight: bold !important;
          padding-bottom: 0.5rem;
          border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        .notification-close-btn {
          color: #666 !important;
        }
      `;
      document.head.appendChild(style);
    }
  }
});
</script>
{% endif %}

<script>
    $(function(){
        $('.sidebar ul li a').filter(function(){return this.href==location.href}).parent().addClass('active').siblings().removeClass('active');
        $('.sidebar ul li a').click(function(){
            $(this).parent().addClass('active').siblings().removeClass('active')
        })
    });

    $('.open-btn').on('click' , function(){
        $('.sidebar').addClass('active');
    });

    $('.close-btn').on('click' , function(){
        $('.sidebar').removeClass('active');
    });

    // bootstrap colapse
    $(document).ready(function () {
        $(".collapse").on("shown.bs.collapse", function () {
            localStorage.setItem("coll_" + this.id, true);
        });

        $(".collapse").on("hidden.bs.collapse", function () {
            localStorage.removeItem("coll_" + this.id);
        });

        $(".collapse").each(function () {
            if (localStorage.getItem("coll_" + this.id) === "true") {
                $(this).collapse("show");
            }
            else {
                $(this).collapse("hide");
            }
        });
    });


</script>

<script>

    document.onreadystatechange = function() {
        if (document.readyState !== "complete") {
            document.querySelector("body").style.visibility = "hidden";
            document.querySelector("#loading").style.visibility = "visible";
        } else {
            document.querySelector("#loading").style.display = "none";
            document.querySelector("body").style.visibility = "visible";
        }
    };
</script>

<script>
// Dark mode toggle functionality
document.addEventListener('DOMContentLoaded', function() {
  const darkModeToggle = document.getElementById('darkModeToggle');
  const lightModeIcon = document.getElementById('lightModeIcon');
  const darkModeIcon = document.getElementById('darkModeIcon');

  // Check if dark mode is enabled on page load
  if (localStorage.getItem('darkMode') === 'enabled') {
    document.body.classList.add('dark-mode');
    lightModeIcon.classList.add('d-none');
    darkModeIcon.classList.remove('d-none');
  }

  // Toggle dark mode
  darkModeToggle.addEventListener('click', function(e) {
    e.preventDefault();
    if (document.body.classList.contains('dark-mode')) {
      document.body.classList.remove('dark-mode');
      localStorage.setItem('darkMode', 'disabled');
      lightModeIcon.classList.remove('d-none');
      darkModeIcon.classList.add('d-none');
    } else {
      document.body.classList.add('dark-mode');
      localStorage.setItem('darkMode', 'enabled');
      lightModeIcon.classList.add('d-none');
      darkModeIcon.classList.remove('d-none');
    }
  });
});
</script>

<script>
// Fullscreen toggle functionality
document.addEventListener('DOMContentLoaded', function() {
  const fullscreenToggle = document.getElementById('fullscreenToggle');
  const expandIcon = document.getElementById('expandIcon');
  const compressIcon = document.getElementById('compressIcon');

  fullscreenToggle.addEventListener('click', function(e) {
    e.preventDefault();

    if (!document.fullscreenElement &&
        !document.mozFullScreenElement &&
        !document.webkitFullscreenElement &&
        !document.msFullscreenElement) {
      // Enter fullscreen
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      } else if (document.documentElement.msRequestFullscreen) {
        document.documentElement.msRequestFullscreen();
      } else if (document.documentElement.mozRequestFullScreen) {
        document.documentElement.mozRequestFullScreen();
      } else if (document.documentElement.webkitRequestFullscreen) {
        document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
      }
      expandIcon.classList.add('d-none');
      compressIcon.classList.remove('d-none');
    } else {
      // Exit fullscreen
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
      expandIcon.classList.remove('d-none');
      compressIcon.classList.add('d-none');
    }
  });

  // Listen for fullscreen change events to update icon state
  document.addEventListener('fullscreenchange', updateFullscreenIcon);
  document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
  document.addEventListener('mozfullscreenchange', updateFullscreenIcon);
  document.addEventListener('MSFullscreenChange', updateFullscreenIcon);

  function updateFullscreenIcon() {
    if (document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement ||
        document.msFullscreenElement) {
      expandIcon.classList.add('d-none');
      compressIcon.classList.remove('d-none');
    } else {
      expandIcon.classList.remove('d-none');
      compressIcon.classList.add('d-none');
    }
  }
});
</script>
</body>
</html>
