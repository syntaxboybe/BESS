{% extends "../base.html" %} {% load static %} {% block content %}


<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">


<style>
  .example1 {
    background-color: #355389;
    border-radius: 25px;
    padding-bottom: 5%;
  }
</style>

<!-- Add Popper.js before Bootstrap script (bootstrap.min.js already included in base.html) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>

<section>
  <div class="container-fluid fade-page">
    <div class="row">
      <div class="col-12 py-2 rounded">
        <div class="example1">
          <div class="row rounded">
            <div class="col-lg-7 col-md-12 my-auto px-5">
              <h1 class="display-6 text-white" style="font-weight: 400">
                Welcome! {{ user.username }}, Your Gateway to Transparent and
                Efficient Governance.
              </h1>
              <p class="lead text-white px-1">
                <b>Barangay Residents as of {% now "F d, Y" %} at {% now "h:i A" %}</b>
              </p>
            </div>

            <div class="col-lg-5 col-md-12">
              <a
                class="text-white float-end px-5"
                style="text-decoration: none; font-size: 10px"
                href="https://www.freepik.com/free-vector/diverse-crowd-people-different-ages-races_7732608.htm"
                >Image by pch.vector</a
              >
              <img
                src="{% static 'img/race.svg' %}"
                class="img-fluid"
                style="max-height: 300px; min-height: 120px"
              />
            </div>

            <div class="col-12 position relative">
              <div class="position-absolute bottom-0 end-0"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col" style="margin-top: -4em">
        <div class="row px-4">
          <div class="col-12 mb-3 d-flex justify-content-end">
            <div>
              <button class="btn btn-sm btn-outline-primary" onclick="downloadSection('demographicsSection', 'Demographics_Cards.jpeg', 'image/jpeg')">
                <i class="fas fa-download"></i> Download as JPEG
              </button>
              <button class="btn btn-sm btn-outline-primary ms-1" onclick="downloadSection('demographicsSection', 'Demographics_Cards.png', 'image/png')">
                <i class="fas fa-download"></i> Download as PNG
              </button>
            </div>
          </div>

          <div id="demographicsSection" class="row">
          <div class="col-lg-4 col-md-12">
            <a href="{% url 'resident_list' %}" style="text-decoration: none">
              <div class="col-md">
                <div
                  class="card text-center text-white mb-3 border-0 shadow"
                  id="resident"
                >
                  <div class="card-header">
                    <h5 class="card-title">
                    <i class="fa-solid fa-users"></i> Registered Residents
                    </h5>
                  </div>
                  <div clas="card-body">
                    <h3 class="card-title">{{cResident}}</h3>
                  </div>
                </div>
              </div>
            </a>
          </div>

          <div class="col-lg-4 col-md-6">
            <div class="col-md">
              <div
                class="card text-center text-white mb-3 border-0 shadow"
                id="male"
              >
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="fa-solid fa-mars"></i> Male
                    </h5>
                </div>
                <div clas="card-body">
                  <h3 class="card-title">{{cMale}}</h3>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4 col-md-6">
            <div class="col-md">
              <div
                class="card text-center text-white mb-3 border-0 shadow"
                id="f"
              >
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="fa-solid fa-venus"></i> Female
                    </h5>
                </div>
                <div clas="card-body">
                  <h3 class="card-title">{{cFemale}}</h3>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <a href="{% url 'single' %}" style="text-decoration: none">
              <div class="col-md">
                <div
                  class="card text-center text-white mb-3 border-0 shadow"
                  id="yes"
                >
                  <div class="card-header">
                    <h5 class="card-title">
                    <i class="fas fa-user"></i> Single Parent
                    </h5>
                  </div>
                  <div clas="card-body">
                    <h3 class="card-title">{{cYes}}</h3>
                  </div>
                </div>
              </div>
            </a>
          </div>

          <div class="col-lg-4">
            <a href="{% url 'pwd' %}" style="text-decoration: none">
              <div class="col-md">
                <div
                  class="card text-center text-white mb-3 border-0 shadow"
                  id="pwd"
                >
                  <div class="card-header">
                    <h5 class="card-title">
                    <i class="fas fa-wheelchair"></i> PWD
                    </h5>
                  </div>
                  <div clas="card-body">
                    <h3 class="card-title">{{cPwd}}</h3>
                  </div>
                </div>
              </div>
            </a>
          </div>
          <div class="col-lg-4">
            <a href="{% url 'senior' %}" style="text-decoration: none">
              <div class="col-md">
                <div
                  class="card text-center text-white mb-3 border-0 shadow"
                  id="senior"
                >
                  <div class="card-header">
                    <h5 class="card-title">
                    <i class="fas fa-user-clock"></i> Senior Citizen
                    </h5>
                  </div>
                  <div clas="card-body">
                    <h3 class="card-title">{{cSenior}}</h3>
                  </div>
                </div>
              </div>
            </a>
          </div>
          <!-- <h4>Civil Status</h4> -->
          <div class="col-lg-3 col-md-6">
            <div class="col-md">
              <div
                class="card text-center text-white mb-3 border-0 shadow"
                id="married"
              >
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="fa fa-ring"></i> Married
                    </h5>
                </div>
                <div clas="card-body">
                  <h3 class="card-title">{{cMarried}}</h3>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="col-md">
              <div
                class="card text-center text-white mb-3 border-0 shadow"
                id="single"
              >
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="fa fa-user-circle"></i> Single
                    </h5>
                </div>
                <div clas="card-body">
                  <h3 class="card-title">{{cSingle}}</h3>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="col-md">
              <div
                class="card text-center text-white mb-3 border-0 shadow"
                id="divorced"
              >
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="fa fa-heart-broken"></i> Divorced
                    </h5>
                </div>
                <div clas="card-body">
                  <h3 class="card-title">{{cDivorced}}</h3>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="col-md">
              <div
                class="card text-center text-white mb-3 border-0 shadow"
                id="widowed"
              >
                <div class="card-header">
                  <h5 class="card-title">
                    <i class="fa fa-ribbon"></i> Widowed
                    </h5>
                </div>
                <div clas="card-body">
                  <h3 class="card-title">{{cWidowed}}</h3>
                </div>
              </div>
            </div>
          </div>
          </div> <!-- Closing tag for demographicsSection div -->
        </div>
      </div>
    </div>
  </div>
</section>

<!-- New Section: Document Request Statistics -->
<section class="mb-4">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow mb-4">
          <div class="card-header py-3 d-flex justify-content-between align-items-center" style="background-color: #355389; color: white;">
            <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i> Document Request Statistics</h5>
            <div>
              <button class="btn btn-sm btn-outline-light" onclick="downloadSection('documentStatsSection', 'Document_Statistics.jpeg', 'image/jpeg')">
                <i class="fas fa-download"></i> Download as JPEG
              </button>
              <button class="btn btn-sm btn-outline-light ms-1" onclick="downloadSection('documentStatsSection', 'Document_Statistics.png', 'image/png')">
                <i class="fas fa-download"></i> Download as PNG
              </button>
            </div>
          </div>
          <div class="card-body" id="documentStatsSection">
            <div class="row">

              <!-- Barangay Clearance -->
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card border-0 shadow h-100">
                  <div class="card-header bg-success text-white">
                    <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i> Barangay Clearance</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 border-end">
                        <div class="text-center">
                          <h6 class="text-muted">Total Requests</h6>
                          <h3>{{ clearance_total|default:"0" }}</h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center">
                          <h6 class="text-muted">Pending</h6>
                          <h3 class="text-warning">{{ clearance_pending|default:"0" }}</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Certificate of Indigency -->
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card border-0 shadow h-100">
                  <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="fas fa-feather-alt me-2"></i> Certificate of Indigency</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 border-end">
                        <div class="text-center">
                          <h6 class="text-muted">Total Requests</h6>
                          <h3>{{ indigency_total|default:"0" }}</h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center">
                          <h6 class="text-muted">Pending</h6>
                          <h3 class="text-warning">{{ indigency_pending|default:"0" }}</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Business Permit -->
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card border-0 shadow h-100">
                  <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="fas fa-file-contract me-2"></i> Business Permit</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 border-end">
                        <div class="text-center">
                          <h6 class="text-muted">Total Requests</h6>
                          <h3>{{ business_total|default:"0" }}</h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center">
                          <h6 class="text-muted">Pending</h6>
                          <h3 class="text-warning">{{ business_pending|default:"0" }}</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Building Permit -->
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card border-0 shadow h-100">
                  <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0"><i class="far fa-building me-2"></i> Building Permit</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 border-end">
                        <div class="text-center">
                          <h6 class="text-muted">Total Requests</h6>
                          <h3>{{ building_total|default:"0" }}</h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center">
                          <h6 class="text-muted">Pending</h6>
                          <h3 class="text-warning">{{ building_pending|default:"0" }}</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Certificate of Residency -->
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card border-0 shadow h-100">
                  <div class="card-header bg-danger text-white">
                    <h6 class="mb-0"><i class="fas fa-certificate me-2"></i> Certificate of Residency</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 border-end">
                        <div class="text-center">
                          <h6 class="text-muted">Total Requests</h6>
                          <h3>{{ residency_total|default:"0" }}</h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center">
                          <h6 class="text-muted">Pending</h6>
                          <h3 class="text-warning">{{ residency_pending|default:"0" }}</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Total Documents -->
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card border-0 shadow h-100">
                  <div class="card-header" style="background-color: #355389; color: white;">
                    <h6 class="mb-0"><i class="fas fa-clipboard-list me-2"></i> All Documents Summary</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 border-end">
                        <div class="text-center">
                          <h6 class="text-muted">Total Requests</h6>
                          <h3>{{ document_total|default:"0" }}</h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center">
                          <h6 class="text-muted">Pending</h6>
                          <h3 class="text-warning">{{ pending_total|default:"0" }}</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Document Request Charts -->
<section class="mb-4">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-6 col-md-12 mb-4">
        <div class="card border-0 shadow h-100">
          <div class="card-header py-3 d-flex justify-content-between align-items-center" style="background-color: #355389; color: white;">
            <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i> Document Request Distribution</h5>
            <div>
              <button class="btn btn-sm btn-outline-light" onclick="downloadChart('documentPieChart', 'Document_Request_Distribution.jpeg', 'image/jpeg')">
                <i class="fas fa-download"></i> Download as JPEG
              </button>
              <button class="btn btn-sm btn-outline-light ms-1" onclick="downloadChart('documentPieChart', 'Document_Request_Distribution.png', 'image/png')">
                <i class="fas fa-download"></i> Download as PNG
              </button>
            </div>
          </div>
          <div class="card-body">
            <canvas id="documentPieChart" width="400" height="300"></canvas>
          </div>
        </div>
      </div>

      <div class="col-lg-6 col-md-12 mb-4">
        <div class="card border-0 shadow h-100">
          <div class="card-header py-3 d-flex justify-content-between align-items-center" style="background-color: #355389; color: white;">
            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i> Documents Status</h5>
            <div>
              <button class="btn btn-sm btn-outline-light" onclick="downloadChart('documentStatusChart', 'Documents_Status.jpeg', 'image/jpeg')">
                <i class="fas fa-download"></i> Download as JPEG
              </button>
              <button class="btn btn-sm btn-outline-light ms-1" onclick="downloadChart('documentStatusChart', 'Documents_Status.png', 'image/png')">
                <i class="fas fa-download"></i> Download as PNG
              </button>
            </div>
          </div>
          <div class="card-body">
            <canvas id="documentStatusChart" width="400" height="300"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<div class="container">
  <div class="row px-4">
    <!-- Radar Chart Section -->
    <div class="col-lg-6 col-md-12">
      <div class="card text-center text-black mb-3 border-0 shadow" style="color: #355389;">
        <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #355389; color: white;">
          <h5 class="card-title mb-0">
            <i class="fa-solid fa-crosshairs"></i> Resident Radar Chart
          </h5>
          <div>
            <button class="btn btn-sm btn-outline-light" onclick="downloadChart('radarChart', 'Resident_Radar_Chart.jpeg', 'image/jpeg')">
              <i class="fas fa-download"></i> Download as JPEG
            </button>
            <button class="btn btn-sm btn-outline-light ms-1" onclick="downloadChart('radarChart', 'Resident_Radar_Chart.png', 'image/png')">
              <i class="fas fa-download"></i> Download as PNG
            </button>
          </div>
        </div>
        <div class="card-body">
          <canvas id="radarChart" width="400" height="400"></canvas>
        </div>
      </div>
    </div>

    <!-- Bar Chart Section -->
    <div class="col-lg-6 col-md-12">
      <div class="card text-center text-black mb-3 border-0 shadow" style="color: #355389;">
        <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #355389; color: white;">
          <h5 class="card-title mb-0">
            <i class="fa-solid fa-chart-bar"></i> Resident Bar Chart
          </h5>
          <div>
            <button class="btn btn-sm btn-outline-light" onclick="downloadChart('residentChart', 'Resident_Bar_Chart.jpeg', 'image/jpeg')">
              <i class="fas fa-download"></i> Download as JPEG
            </button>
            <button class="btn btn-sm btn-outline-light ms-1" onclick="downloadChart('residentChart', 'Resident_Bar_Chart.png', 'image/png')">
              <i class="fas fa-download"></i> Download as PNG
            </button>
          </div>
        </div>
        <div class="card-body">
          <canvas id="residentChart" width="400" height="400"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  // Dynamic data from Django context
  var cResident = {{ cResident }};
  var cMale = {{ cMale }};
  var cFemale = {{ cFemale }};
  var cYes = {{ cYes }};
  var cPwd = {{ cPwd }};
  var cSenior = {{ cSenior }};
  var cMarried = {{ cMarried }};
  var cSingle = {{ cSingle }};
  var cDivorced = {{ cDivorced }};
  var cWidowed = {{ cWidowed }};

  // Function to download charts as images
  function downloadChart(chartId, filename, mimeType) {
    const canvas = document.getElementById(chartId);
    if (!canvas) {
      console.error('Chart canvas not found:', chartId);
      Swal.fire({
        title: 'Error',
        text: 'Could not find the chart to download',
        icon: 'error',
        timer: 2000,
        showConfirmButton: false
      });
      return;
    }

    try {
      // Show loading indicator
      Swal.fire({
        title: 'Preparing download...',
        text: 'Please wait',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      // For charts, we can directly get the image from the canvas
      const image = canvas.toDataURL(mimeType, 1.0);

      // Create a download link
      const downloadLink = document.createElement('a');
      downloadLink.href = image;
      downloadLink.download = filename;

      // Trigger the download
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);

      // Close loading indicator
      setTimeout(() => {
        Swal.close();
      }, 500);
    } catch (error) {
      console.error('Error downloading chart:', error);
      Swal.fire({
        title: 'Error',
        text: 'Failed to download the chart',
        icon: 'error',
        timer: 2000
      });
    }
  }

  // Function to download a section (like stats cards)
  function downloadSection(sectionId, filename, mimeType) {
    const section = document.getElementById(sectionId);
    if (!section) {
      console.error('Section not found:', sectionId);
      Swal.fire({
        title: 'Error',
        text: 'Could not find the section to download',
        icon: 'error',
        timer: 2000,
        showConfirmButton: false
      });
      return;
    }

    // Show loading indicator
    Swal.fire({
      title: 'Preparing download...',
      text: 'Please wait',
      allowOutsideClick: false,
      didOpen: () => {
        Swal.showLoading();
      }
    });

    // Check if we're in dark mode
    const isDarkMode = document.body.classList.contains('dark-mode');

    // Create a clone of the section to capture
    const sectionClone = section.cloneNode(true);
    sectionClone.style.position = 'absolute';
    sectionClone.style.left = '-9999px';
    sectionClone.style.top = '-9999px';
    document.body.appendChild(sectionClone);

    // Force light mode styles for the clone if needed
    if (isDarkMode) {
      // Process all child elements to ensure proper styling
      const applyLightModeStyles = (element) => {
        // Remove dark mode classes
        if (element.classList) {
          element.classList.remove('dark-mode');
        }

        // Apply light background to cards if they have dark backgrounds
        if (element.classList && element.classList.contains('card')) {
          // Ensure card backgrounds are white/light
          element.style.backgroundColor = '#ffffff';
          element.style.color = '#333333';
        }

        // Fix text colors
        if (element.classList && (element.classList.contains('text-white') || element.classList.contains('text-light'))) {
          if (!element.closest('.card-header')) { // Don't change header text colors
            element.style.color = '#333333';
          }
        }

        // Apply to all children
        if (element.children && element.children.length > 0) {
          Array.from(element.children).forEach(child => {
            applyLightModeStyles(child);
          });
        }
      };

      // Start processing from the clone
      applyLightModeStyles(sectionClone);
    }

    // Create screenshot of the section
    html2canvas(sectionClone, {
      scale: 2, // Higher scale for better quality
      backgroundColor: '#ffffff', // Force white background
      logging: false,
      useCORS: true,
      allowTaint: true
    }).then(canvas => {
      try {
        // Convert to image data
        const image = canvas.toDataURL(mimeType, 1.0);

        // Create a download link
        const downloadLink = document.createElement('a');
        downloadLink.href = image;
        downloadLink.download = filename;

        // Trigger the download
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        // Remove the cloned section
        document.body.removeChild(sectionClone);

        // Close loading indicator
        setTimeout(() => {
          Swal.close();
        }, 500);
      } catch (error) {
        console.error('Error processing download:', error);
        Swal.fire({
          title: 'Error',
          text: 'Failed to process the download',
          icon: 'error',
          timer: 2000
        });

        // Clean up
        if (document.body.contains(sectionClone)) {
          document.body.removeChild(sectionClone);
        }
      }
    }).catch(error => {
      console.error('Error capturing section:', error);
      Swal.fire({
        title: 'Error',
        text: 'Failed to capture the section',
        icon: 'error',
        timer: 2000
      });

      // Clean up
      if (document.body.contains(sectionClone)) {
        document.body.removeChild(sectionClone);
      }
    });
  }

  // Bar Chart
  var barCtx = document.getElementById('residentChart').getContext('2d');
  var residentChart = new Chart(barCtx, {
    type: 'bar',
    data: {
      labels: ['Registered Residents', 'Male', 'Female', 'Single Parent', 'PWD', 'Senior Citizen', 'Married', 'Single', 'Divorced', 'Widowed'],
      datasets: [{
        label: 'Resident Count',
        data: [cResident, cMale, cFemale, cYes, cPwd, cSenior, cMarried, cSingle, cDivorced, cWidowed],
        backgroundColor: [
          '#355389', '#89b4fa', '#f5c2e7', '#cba6f7', '#f38ba8', '#a6e3a1',
          '#94e2d5', '#74c7ec', '#fab387', '#b4befe'
        ],
        borderColor: '#fff',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Radar Chart
  var radarCtx = document.getElementById('radarChart').getContext('2d');
  var radarChart = new Chart(radarCtx, {
    type: 'radar',
    data: {
      labels: ['Registered Residents', 'Male', 'Female', 'Single Parent', 'PWD', 'Senior Citizen', 'Married', 'Single', 'Divorced', 'Widowed'],
      datasets: [{
        label: 'Resident Count',
        data: [cResident, cMale, cFemale, cYes, cPwd, cSenior, cMarried, cSingle, cDivorced, cWidowed],
        backgroundColor: 'rgba(53, 83, 137, 0.5)',
        borderColor: '#355389',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      scales: {
        r: {
          angleLines: {
            color: '#ccc'
          },
          grid: {
            color: '#ddd'
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  });

  // Document Pie Chart
  var docPieCtx = document.getElementById('documentPieChart').getContext('2d');
  var documentPieChart = new Chart(docPieCtx, {
    type: 'pie',
    data: {
      labels: ['Barangay Clearance', 'Certificate of Indigency', 'Business Permit', 'Building Permit', 'Certificate of Residency'],
      datasets: [{
        data: [
          {{ clearance_total|default:"0" }},
          {{ indigency_total|default:"0" }},
          {{ business_total|default:"0" }},
          {{ building_total|default:"0" }},
          {{ residency_total|default:"0" }}
        ],
        backgroundColor: [
          '#28a745', // green
          '#17a2b8', // info
          '#007bff', // primary
          '#6c757d', // secondary
          '#dc3545'  // danger
        ],
        borderColor: '#fff',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'right',
        },
        title: {
          display: true,
          text: 'Distribution of Document Requests',
          font: {
            size: 16
          }
        }
      }
    }
  });

  // Document Status Chart
  var docStatusCtx = document.getElementById('documentStatusChart').getContext('2d');
  var documentStatusChart = new Chart(docStatusCtx, {
    type: 'bar',
    data: {
      labels: ['Barangay Clearance', 'Certificate of Indigency', 'Business Permit', 'Building Permit', 'Certificate of Residency'],
      datasets: [
        {
          label: 'Total Requests',
          data: [
            {{ clearance_total|default:"0" }},
            {{ indigency_total|default:"0" }},
            {{ business_total|default:"0" }},
            {{ building_total|default:"0" }},
            {{ residency_total|default:"0" }}
          ],
          backgroundColor: 'rgba(53, 83, 137, 0.7)'
        },
        {
          label: 'Pending Requests',
          data: [
            {{ clearance_pending|default:"0" }},
            {{ indigency_pending|default:"0" }},
            {{ business_pending|default:"0" }},
            {{ building_pending|default:"0" }},
            {{ residency_pending|default:"0" }}
          ],
          backgroundColor: 'rgba(255, 193, 7, 0.7)'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          stacked: false
        },
        y: {
          beginAtZero: true
        }
      },
      plugins: {
        title: {
          display: true,
          text: 'Total vs Pending Document Requests',
          font: {
            size: 16
          }
        }
      }
    }
  });
</script>

{% endblock content %}
